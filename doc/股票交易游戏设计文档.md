# 股票交易游戏设计文档

## 核心设计理念
- 完全玩家驱动经济：所有数据均由玩家交易行为产生
- 去随机化：不设置NPC、不生成随机事件，所有变化来自玩家决策
- 实时市场反馈：玩家行为即时影响市场
- 全天候交易市场：现实时间24小时连续交易
- 个人开发者，不要太复杂
- 游戏模块包括：公司模块 银行模块 交易所模块 消息模块，这四个模块是相互关联的；暂时不需要要别的模块，帮我完善模块。

## 新增：玩家账户体系
### 1. 账户创建
- 新玩家初始获得1000万游戏币（由央行发行）
- 每个玩家限制：
  - 同IP最多3个账号
  - 每24小时最多创建1个新账号
- 交易限制：
  - 买入时需预留1%手续费和维护费
  - 卖出时需预留0.1%手续费

### 2. 资金流转
- 所有资金操作必须通过玩家账户进行
- 创建公司时从个人账户扣除初始资金
- 交易、分红等收入自动存入个人账户
- 账户资金可用于：
  * 创建公司
  * 股票交易
  * 银行存款
  * 购买债券

## 游戏模块设计

### 1. 公司模块
#### 1.1 公司创建
- 玩家使用个人账户资金（最低50万游戏币）注册公司
- 基础信息设置：
  - 公司名称（需唯一）
  - 初始股价定价规则：
    * 基础价格 = 注册资本/总股本
    * 行业估值调整：基础价格 × 行业平均PE
    * 最终价格范围：10-100元
  - 总股本（10万-100万股自选）
  - 行业分类（制造业/科技/服务等基础分类）
- 新股上市规则：
  * 首日涨跌幅限制±50%
  * 次日起限制为±20%

#### 1.2 股权结构
- 创始人初始持股比例 = 初始资金 / (股价×总股本)
- 最低持股比例≥20%（不足时自动调整总股本）
- 股东权益：
  a. 表决权（每股1票）
  b. 分红权
  c. 剩余资产分配权
  d. 提案权（持股≥5%可发起议案）
- 每日自动生成公司资产负债表（仅含现金资产）
- 股东可随时查看：
  * 实时持股比例
  * 公司现金余额
  * 最近3次分红记录
- 动态股权看板：
  * 实时显示前十大股东变更记录
  * 质押股份特殊标记

#### 1.3 公司经营
- 玩家可进行的操作：
  1. 分红决策：按持股比例分配现金
  2. 增发股票：需股东投票通过（持股超51%同意）
  3. 股票回购：使用公司现金从市场回购
  4. 破产申请：当公司现金 ≤ 0 且无贷款能力时
  5. 公司收购：
    - 收购方式：
      a. 市场收购：通过交易所购买，当持股达51%时自动获得控制权
    - 收购条件：
      - 无前置条件，可随时购买
    - 收购流程：
      直接通过市场交易积累股权，达51%自动生效（与交易所模块3.2公示规则联动）
    - 收购结果：
      - 成功：目标公司并入收购方，原股票按市价强制结算
      - 无失败惩罚（自由交易）
    - 反收购措施：
      - 当公司现金≥流通市值5%时，自动回购0.5%股份/小时
  6. 股票拆分/合并：
    - 拆分：1股拆为2-10股（股价按比例降低）
    - 合并：2-10股合并为1股（股价按比例提升）
    - 需股东超50%同意且总股本保持10万-1000万股范围
  7. 股票质押融资：
    - 股东可将股票质押给银行获取现金（质押率根据银行评级系统动态调整）
    - 当股价下跌至质押价值120%时强制平仓
    - 质押期间丧失股票投票权
  8. 可启用DRIP计划：股息自动转换为股票（免手续费）
  9. 转换价格=当日均价×95%
- 股东专属功能：
  1. 议案发起（需持股≥5%）：
    - 类型：分红/并购/章程修改等
    - 投票期24小时，通过需＞50%赞成
  2. 股票委托交易：
    - 可设置条件单（价格/数量）
    - 有效期最长7天（现实时间）
  3. 股东名册查询：
    - 查看前10大股东持股情况
    - 匿名显示其他股东（仅显示持股比例区间）

#### 1.4 财务系统
- 收入来源：
  - 其他玩家交易股票时缴纳0.1%手续费（进入公司现金）
  - 股东注资（按持股比例分配）
  - 股票质押管理费（质押金额的0.05%/日）
- 支出项目：
  - 分红支出
  - 银行利息（如果贷款）
  - 系统维护费（每日总股本×0.001元）
  - 股票拆分/合并手续费（操作金额的1%）
- 股东提案处理费：发起议案需支付1000元基础费+0.1%持股价值
- 债务优先级：
  - 破产清算时优先偿还银行贷款（与银行模块2.3风险控制联动）
  - 剩余资金按股东权益分配
- 利率敏感机制：
  * 贷款利息 = 基准利率×(1+公司风险溢价)
  * 风险溢价范围：1%~300%（根据股价波动率计算）
  * 银行利率变动后下一个整点更新参数（与消息模块4跨事件通知联动）

#### 1.5 破产机制
- 触发条件：
  * 连续24小时现金为负 且
  * 无可质押资产 且
  * 无法获得新贷款
- 清算流程：
  1. 公司股票永久停牌
  2. 剩余现金按持股比例分配
  3. 创始人需72小时后才能创建新公司
- 债务清算顺序：
  1. 员工工资（如有）
  2. 银行贷款
  3. 股东权益

### 2. 银行模块
#### 2.0 银行体系架构
- 统一银行系统：
  - 账户管理：
    * 开户：游戏开始自动开通
    * 初始资金：100万游戏币
    * 账户类型：
      - 个人账户
      - 公司账户
  - 资金管理：
    * 个人账户功能：
      - 存取款（实时到账）
      - 股票交易资金
      - 信用贷款
    * 公司账户功能：
      - 资金归集
      - 分红派息
      - 增发配股
  - 利率系统：
    * 存款利率：年化3%
    * 贷款利率：年化6%
    * 信用贷款：年化10%

#### 2.1 核心功能
- 账户体系：
  - 个人账户：
    * 基础功能：
      - 存取款
      - 转账
      - 股票交易资金管理
    * 贷款功能：
      - 信用贷款
      - 股票质押贷款
  - 公司账户：
    * 资金管理：
      - 分红派息
      - 股票回购
      - 增发配股
    * 贷款管理：
      - 信用额度
      - 资产质押

#### 2.2 风险控制
- 贷款限制：
  * 个人信用贷款：不超过存款的50%
  * 股票质押贷款：不超过持股市值的40%
  * 公司信用贷款：不超过公司市值的30%
- 质押管理：
  * 预警线：130%
  * 平仓线：120%
  * 强制平仓：
    - 120%时强制平仓
    - T+1日内完成
- 债务追讨：
  * 个人账户：冻结交易
  * 公司账户：停止分红

#### 2.3 清算系统
- 实时清算：
  * 交易资金实时冻结
  * 成交后即时清算
  * 资金实时到账
  * 资金冻结优先级：
    - 交易保证金
    - 手续费
    - 维护费
    - 贷款利息
    - 其他费用
- 破产处理：
  * 个人破产：
    - 清算所有资产
    - 按比例还债
    - 账户限制
  * 公司破产：
    - 停牌清算
    - 资产变现
    - 按优先级还债

### 3. 交易所模块
#### 3.1 交易机制
- 订单类型：
  - 限价单（有效期6小时）
  - 市价单（立即成交剩余撤单）
  - 条件单（支持＞/＜触发价）
- 撮合规则：
  - 价格优先 → 时间优先
  - 最小变动单位0.01元
  - 每笔交易≥100股

#### 3.2 市场监控
- 异常交易监控：
  * 同IP账户互相交易限制
  * 大额交易分步执行：
    - 单笔＞总股本1%自动拆分
    - 每3分钟执行一次，最多分10次
  * 价格操纵识别：
    - 监控短期内高频小额交易
    - 识别虚假申报行为
- 做空机制优化：
  * 允许做空时间：上市满30天后
  * 单只股票做空上限：流通股本的3%
  * 做空保证金：10%现金+10%证券
- 收购公示：
  - 当单日增持＞5%时自动发公告
  - 持股达20%时强制公示资金来源（与公司模块1.3.5收购条件联动）
- 强制平仓条件：
  * 保证金低于维持保证金时
  * 做空持仓时间超过30天
  * 市场剧烈波动时（日内涨幅超过10%）

#### 3.3 数据服务
- 实时行情：
  - 五档盘口（买1-5/卖1-5）
  - 分时图（每分钟一个数据点）
  - K线图（5分钟/1小时/日线）
- 历史数据：
  - 保存完整交易记录
  - 提供CSV格式下载（延迟15分钟）
- 关联指标：
  - 显示公司主要贷款银行信息
  - 质押股票状态可视化（冻结/流通）

### 4. 消息模块
- 系统公告：
  - 实时显示全服重要事件（如收购/破产/重大政策变动）
  - 保留24小时后自动删除
- 股票详情页：
  - 显示公司最新公告（如分红/增发/收购/破产）
  - 保留24小时后自动删除
- 交易界面：
  - 浮动提示收购/破产/重大政策变动等消息
- 跨模块事件通知：
  * 银行利率变动实时推送至公司财务系统
  * 公司质押率变化同步至交易所行情面板
  * 交易所异常波动触发银行风险控制检查
  * 银行挤兑事件同步至关联公司股票公告

## 跨模块清算机制
### 1. 公司破产清算
- 银行模块：自动核销坏账并扣减存款准备金
- 交易所模块：立即停牌并启动剩余资产拍卖
- 消息模块：推送清算进度（每完成20%发送通知）

### 2. 银行破产处置
- 公司模块：已质押股票自动转入央行托管
- 交易所模块：冻结相关公司股票交易1小时
- 消息模块：实时更新存款兑付进度

## 经济周期调节
### 1. 通货膨胀控制
- 货币回收机制：
  * 交易手续费80%自动销毁
  * 系统维护费100%销毁

### 2. 市场干预
- 极端行情干预：
  * 全市场暴跌超过30%时
  * 取消当日交易手续费
