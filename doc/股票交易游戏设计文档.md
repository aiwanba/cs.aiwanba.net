# 股票交易游戏设计文档

## 核心设计理念
- 完全玩家驱动经济：所有数据均由玩家交易行为产生
- 去随机化：不设置NPC、不生成随机事件，所有变化来自玩家决策
- 实时市场反馈：玩家行为即时影响市场
- 全天候交易市场：现实时间24小时连续交易
- 个人开发者，不要太复杂
- 游戏模块包括：公司模块 银行模块 交易所模块 消息模块，这四个模块是相互关联的；暂时不需要要别的模块，帮我完善模块。

## 游戏模块设计

### 1. 公司模块
#### 1.1 公司创建
- 玩家使用初始资金（如1000万游戏币）注册公司
- 基础信息设置：
  - 公司名称（需唯一）
  - 初始股价（10-100元区间自定）
  - 总股本（10万-100万股自选）
  - 行业分类（制造业/科技/服务等基础分类）

#### 1.2 股权结构
- 创始人初始持股比例 = 初始资金 / (股价×总股本)
- 最低持股比例≥20%（不足时自动调整总股本）
- 股东权益：
  a. 表决权（每股1票）
  b. 分红权
  c. 剩余资产分配权
  d. 提案权（持股≥5%可发起议案）
- 每日自动生成公司资产负债表（仅含现金资产）
- 股东可随时查看：
  * 实时持股比例
  * 公司现金余额
  * 最近3次分红记录
- 动态股权看板：
  * 实时显示前十大股东变更记录
  * 质押股份特殊标记

#### 1.3 公司经营
- 玩家可进行的操作：
  1. 分红决策：按持股比例分配现金
  2. 增发股票：需股东投票通过（持股超51%同意）
  3. 股票回购：使用公司现金从市场回购
  4. 破产申请：当公司现金 ≤ 0 且无贷款能力时
  5. 公司收购：
    - 收购方式：
      a. 市场收购：通过交易所购买，当持股达51%时自动获得控制权
    - 收购条件：
      - 无前置条件，可随时购买
    - 收购流程：
      直接通过市场交易积累股权，达51%自动生效（与交易所模块3.2公示规则联动）
    - 收购结果：
      - 成功：目标公司并入收购方，原股票按市价强制结算
      - 无失败惩罚（自由交易）
    - 反收购措施：
      - 当公司现金≥流通市值5%时，自动回购0.5%股份/小时
  6. 股票拆分/合并：
    - 拆分：1股拆为2-10股（股价按比例降低）
    - 合并：2-10股合并为1股（股价按比例提升）
    - 需股东超50%同意且总股本保持10万-1000万股范围
  7. 股票质押融资：
    - 股东可将股票质押给银行获取现金（质押率根据银行评级系统动态调整）
    - 当股价下跌至质押价值120%时强制平仓
    - 质押期间丧失股票投票权
  8. 可启用DRIP计划：股息自动转换为股票（免手续费）
  9. 转换价格=当日均价×95%
- 股东专属功能：
  1. 议案发起（需持股≥5%）：
    - 类型：分红/并购/章程修改等
    - 投票期24小时，通过需＞50%赞成
  2. 股票委托交易：
    - 可设置条件单（价格/数量）
    - 有效期最长7天（现实时间）
  3. 股东名册查询：
    - 查看前10大股东持股情况
    - 匿名显示其他股东（仅显示持股比例区间）

#### 1.4 财务系统
- 收入来源：
  - 其他玩家交易股票时缴纳0.1%手续费（进入公司现金）
  - 股东注资（按持股比例分配）
  - 股票质押管理费（质押金额的0.05%/日）
- 支出项目：
  - 分红支出
  - 银行利息（如果贷款）
  - 系统维护费（每日总股本×0.001元）
  - 股票拆分/合并手续费（操作金额的1%）
- 股东提案处理费：发起议案需支付1000元基础费+0.1%持股价值
- 债务优先级：
  - 破产清算时优先偿还银行贷款（与银行模块2.3风险控制联动）
  - 剩余资金按股东权益分配
- 利率敏感机制：
  * 贷款利息 = 基准利率×(1+公司风险溢价)
  * 风险溢价范围：1%~300%（根据股价波动率计算）
  * 银行利率变动后下一个整点更新参数（与消息模块4跨事件通知联动）

#### 1.5 破产机制
- 触发条件：连续24小时现金为负
- 清算流程：
  1. 公司股票永久停牌
  2. 剩余现金按持股比例分配
  3. 创始人需72小时后才能创建新公司
- 债务清算顺序：
  1. 员工工资（如有）
  2. 银行贷款
  3. 股东权益

### 2. 银行模块
#### 2.0 银行体系架构
- 中央银行（系统自动运行）：
  - 发行基础货币（初始1亿游戏币）
  - 统一资金清算：
    * 所有资金流转必须通过央行系统
    * 实时监控全服资金流动
  - 设定基准利率（影响全服存贷利率）
  - 货币调控工具：
    a. 存款准备金率（初始10%）
    b. 再贴现率（日利率0.1%）
    c. 公开市场操作（自动买卖国债）：
       - 发行条件：
         * 当全服M2增速＞15%持续3天
         * 通胀率连续5日＞10%
         * 商业银行平均存贷比＞75%
       - 发行规则：
         1. 发行量 = 超额流动性×20%（最低1亿游戏币）
         2. 期限结构：1月/3月/1年三档（比例4:3:3）
         3. 利率机制：
            - 1月期：基准利率×1.2
            - 3月期：基准利率×1.5
            - 1年期：基准利率×2.0
       - 发行方式：
         a. 荷兰式拍卖：每日10:00统一竞标
         b. 最小认购单位100万游戏币
         c. 商业银行必须参与（最低认购额=存款规模×5%）
       - 流通机制：
         * 上市次日可银行间转让
         * 个人玩家可通过商业银行柜台交易
         * 到期自动兑付（本息转入央行账户）
       - 特别条款：
         * 经济危机期间（GDP增速＜-5%）暂停发行
         * 当国债收益率曲线倒挂时，自动缩短发行期限
- 商业银行（玩家可创建）：
  - 创建条件：
    * 注册资本≥5000万
    * 持有银行牌照（限量10张/拍卖获得）
  - 核心功能：
    * 自主设定存贷款利率（在基准利率±50%内）
    - 央行特别措施：
      * 当全服通胀率＞10%时，自动发行国债回收流动性
      * 经济危机期间启动量化宽松（每日注入0.1%基础货币）

#### 2.1 核心功能
- 存款准备金：
  - 必须将存款的10%存入中央银行
  - 按央行要求缴纳存款准备金（比率动态调整）
  - 准备金不足时禁止发放新贷款
  - 资金流转：
    - 所有存取款操作实时通过央行系统
    - 跨行转账由央行清算（手续费0.1%）
- 活期存款：利率在基准利率±50%范围内自定（与央行模块2.0联动）
- 定期存款：期限/利率由商业银行自定

#### 2.2 利率机制
- 基准利率调整规则：
  - 通货膨胀率＞5%时：基准利率+0.1%/日
  - 通货紧缩时：基准利率-0.05%/日
- 商业银行利率浮动范围：基准利率±50%

#### 2.3 风险控制
- 资本充足率要求：风险资产 ≤ 自有资本8倍
- 由央行每日审计，不达标银行暂停业务
- 挤兑机制：当单日取款＞存款20%时，触发3日冷静期
- 同业拆借：可向其他玩家银行拆借（利率双方协商）
- 挤兑期间由央行提供紧急流动性支持（利率0.3%/日）

#### 2.4 银行经营
- 玩家银行操作：
  1. 利率管理：设置各期限存贷利率
  2. 理财产品：设计不同风险等级产品
  3. 同业拆借：与其他玩家银行资金往来
  4. 风险控制：实时监控资本充足率
- 信贷评级系统：
  - 根据公司股价波动率调整质押率（30%-70%动态范围）
  - 股票质押率动态规则：
    * 质押率 = 基础质押率50% × (1 - 股价月波动率)
    * 最高不超过70%，最低不低于30%
    * 实时同步至公司模块1.3.7股票质押融资规则
  - 连续分红企业获得利率优惠（-0.02%/日）
- 破产条件：
  - 连续72小时资本充足率＜8%
  - 存款挤兑超过总资产90%

### 3. 交易所模块
#### 3.1 交易机制
- 订单类型：
  - 限价单（有效期6小时）
  - 市价单（立即成交剩余撤单）
  - 条件单（支持＞/＜触发价）
- 撮合规则：
  - 价格优先 → 时间优先
  - 最小变动单位0.01元
  - 每笔交易≥100股

#### 3.2 市场监控
- 异常波动机制：
  - 30分钟内涨跌±20%时标记异常状态
  - 异常期间交易手续费提升至0.3%
  - 大单追踪：单笔＞总股本1%的交易实时公告
- 收购公示：
  - 当单日增持＞5%时自动发公告
  - 持股达20%时强制公示资金来源（与公司模块1.3.5收购条件联动）
- 做空机制：
  * 允许借券做空（需5%保证金）
  * 做空费率=基准利率×2
- 大额交易处理：
  * 单笔＞5%总股本交易自动拆分为10次成交（每分钟成交1/10）
  * 成交价按实时盘口价执行
- 借券来源：
  a. 公司库存股（来自回购未注销部分）
  - 需在公司模块1.3.3明确：回购股票50%自动注销，50%转为库存股
  b. 股东质押股票（需质押方同意）
  c. 做市商储备（系统初始提供各公司1%股本）
- 强制平仓联动：
  * 触发公司模块1.3.7平仓规则时，自动生成市价卖单

#### 3.3 数据服务
- 实时行情：
  - 五档盘口（买1-5/卖1-5）
  - 分时图（每分钟一个数据点）
  - K线图（5分钟/1小时/日线）
- 历史数据：
  - 保存完整交易记录
  - 提供CSV格式下载（延迟15分钟）
- 关联指标：
  - 显示公司主要贷款银行信息
  - 质押股票状态可视化（冻结/流通）

### 4. 消息模块
- 系统公告：
  - 实时显示全服重要事件（如收购/破产/重大政策变动）
  - 保留24小时后自动删除
- 股票详情页：
  - 显示公司最新公告（如分红/增发/收购/破产）
  - 保留24小时后自动删除
- 交易界面：
  - 浮动提示收购/破产/重大政策变动等消息
- 跨模块事件通知：
  * 银行利率变动实时推送至公司财务系统
  * 公司质押率变化同步至交易所行情面板
  * 交易所异常波动触发银行风险控制检查
  * 银行挤兑事件同步至关联公司股票公告

## 跨模块清算机制
### 1. 公司破产清算
- 银行模块：自动核销坏账并扣减存款准备金
- 交易所模块：立即停牌并启动剩余资产拍卖
- 消息模块：推送清算进度（每完成20%发送通知）

### 2. 银行破产处置
- 公司模块：已质押股票自动转入央行托管
- 交易所模块：冻结相关公司股票交易1小时
- 消息模块：实时更新存款兑付进度
