# 股票交易游戏设计文档

## 核心设计理念
- AI驱动的市场：所有交易数据由玩家和AI交易者产生
- 真实市场模拟：模拟真实股票市场的核心机制
- 实时市场反馈：所有行为即时影响市场
- 可控游戏节奏：支持暂停和加速
- 个人开发者，保持简单实用
- 游戏模块包括：公司模块、银行模块、交易所模块、消息模块和AI交易模块

## 游戏系统
### 1. 游戏控制
- 时间系统：
  * 1现实秒 = 1游戏分钟
  * 游戏速度：0.5x - 4x可调
  * 支持暂停
- 存档系统：
  * 自动存档：每小时一次，保留最近10个
  * 手动存档：最多20个
  * 存档内容：玩家数据、市场状态、AI状态

### 2. AI交易系统
- AI交易者：
  * 初始10-20个AI交易者
  * 交易风格：
    - 价值投资型：关注公司基本面
    - 趋势跟随型：追踪价格趋势
    - 高频交易型：频繁小额交易
    - 做市商型：提供市场流动性
  * 资金规模：5000万-5亿不等
  * 交易行为：
    - 自动分析市场
    - 参与公司投票
    - 响应增发配股
    - 提供市场流动性

### 3. 玩家账户
- 初始资金：1000万游戏币
- 交易限制：
  * 统一交易手续费：0.1%
- 资金用途：
  * 创建公司
  * 股票交易
  * 银行存款

## 游戏模块设计

### 1. 公司模块
#### 1.1 公司创建
- 玩家使用个人账户资金（最低100万游戏币）注册公司
- 基础信息设置：
  - 公司名称（需唯一）
  - 初始股价定价规则：
    * 基础价格 = 注册资本/总股本
    * 行业估值调整：基础价格 × 行业平均PE
    * 最终价格范围：10-100元
  - 总股本（10万-100万股自选）
  - 行业分类（制造业/科技/服务等基础分类）
- 新股上市规则：
  * 首日涨跌幅限制±50%
  * 次日起限制为±20%

#### 1.2 股权结构
- 创始人初始持股比例 = 初始资金 / (股价×总股本)
- 最低持股比例≥20%（不足时自动调整总股本）
- 股东权益：
  a. 表决权（每股1票）
  b. 分红权
  c. 剩余资产分配权
  d. 提案权（持股≥5%可发起议案）
- 每日自动生成公司资产负债表（仅含现金资产）
- 股东可随时查看：
  * 实时持股比例
  * 公司现金余额
  * 最近3次分红记录
- 动态股权看板：
  * 实时显示前十大股东变更记录
  * 质押股份特殊标记

#### 1.3 公司经营
- 玩家和AI都可以：
  1. 分红决策
  2. 增发股票
  3. 股票回购
  4. 公司收购
  5. 股票拆分/合并：
    - 拆分：1股拆为2-10股（股价按比例降低）
    - 合并：2-10股合并为1股（股价按比例提升）
    - 需股东超50%同意且总股本保持10万-1000万股范围
  6. 股票质押融资：
    - 质押规则：
      * 固定质押率：50%
      * 质押期限：最长30天
      * 提前赎回：需支付剩余利息的20%
    - 当股价下跌至质押价值120%时强制平仓
    - 质押期间丧失股票投票权
  7. 可启用DRIP计划：股息自动转换为股票（免手续费）
  8. 转换价格=当日均价×95%
- 股东专属功能：
  1. 议案发起（需持股≥5%）：
    - 类型：分红/并购/章程修改等
    - 投票期24小时，通过需＞50%赞成
  2. 股票委托交易：
    - 可设置条件单（价格/数量）
    - 有效期最长7天（现实时间）
  3. 股东名册查询：
    - 查看前10大股东持股情况
    - 匿名显示其他股东（仅显示持股比例区间）

#### 1.4 财务系统
- 收入来源：
  - 其他玩家交易股票时缴纳0.1%手续费（进入公司现金）
  - 股东注资（按持股比例分配）
  - 股票质押管理费（质押金额的0.05%/日）
- 支出项目：
  - 分红支出
  - 银行利息（如果贷款）
  - 系统维护费（每日总股本×0.001元）
  - 股票拆分/合并手续费（操作金额的1%）
- 股东提案处理费：发起议案需支付1000元基础费+0.1%持股价值
- 债务优先级：
  - 破产清算时优先偿还银行贷款（与银行模块2.3风险控制联动）
  - 剩余资金按股东权益分配
- 利率敏感机制：
  * 贷款利息 = 基准利率×(1+公司风险溢价)
  * 风险溢价范围：1%~300%（根据股价波动率计算）
  * 银行利率变动后下一个整点更新参数（与消息模块4跨事件通知联动）

#### 1.5 破产机制
- 触发条件：
  * 资产总值低于负债总额
  * 连续12小时无法补充资金
- 清算流程：
  1. 公司股票永久停牌
  2. 剩余现金按持股比例分配
  3. 创始人需72小时后才能创建新公司
- 清算顺序：
  1. 交易手续费和维护费
  2. 银行贷款本息
  3. 员工工资（如有）
  4. 优先股股东（如有）
  5. 普通股股东

### 2. 银行模块
#### 2.0 银行体系架构
- 统一银行系统：
  - 账户管理：
    * 开户：游戏开始自动开通
    * 账户类型：
      - 个人账户
      - 公司账户
  - 资金管理：
    * 个人账户功能：
      - 存取款（实时到账）
      - 股票交易资金
      - 信用贷款
    * 公司账户功能：
      - 资金归集
      - 分红派息
      - 增发配股
  - 利率系统：
    * 存款利率：年化3%
    * 贷款利率：年化6%
    * 信用贷款：年化10%

#### 2.1 核心功能
- 账户体系：
  - 个人账户：
    * 基础功能：
      - 存取款
      - 转账
      - 股票交易资金管理
    * 贷款功能：
      - 信用贷款
      - 股票质押贷款
  - 公司账户：
    * 资金管理：
      - 分红派息
      - 股票回购
      - 增发配股
    * 贷款管理：
      - 信用额度
      - 资产质押

#### 2.2 风险控制
- 贷款限制：
  * 个人信用贷款：不超过存款的50%
  * 股票质押贷款：不超过持股市值的40%
  * 公司信用贷款：不超过公司市值的30%
- 质押管理：
  * 预警线：130%
  * 平仓线：120%
  * 强制平仓：
    - 120%时强制平仓
    - T+1日内完成
- 债务追讨：
  * 个人账户：冻结交易
  * 公司账户：停止分红

#### 2.3 清算系统
- 实时清算：
  * 交易资金实时冻结
  * 成交后即时清算
  * 资金实时到账
  * 资金冻结优先级：
    - 交易保证金
    - 手续费
    - 维护费
    - 贷款利息
    - 其他费用
- 破产处理：
  * 个人破产：
    - 清算所有资产
    - 按比例还债
    - 账户限制
  * 公司破产：
    - 停牌清算
    - 资产变现
    - 按优先级还债

### 3. 交易所模块
#### 3.1 交易机制
- 订单类型：
  - 限价单（有效期6小时）
  - 市价单（立即成交剩余撤单）
- 交易限制：
  * 涨跌幅限制：±20%（首日±50%）
  * 最小交易单位：100股
- 撮合规则：
  - 价格优先 → 时间优先
  - 最小变动单位0.01元

#### 3.2 市场定价
- 基础价格影响因素：
  * 公司基本面（现金流、分红等）
  * AI交易行为
  * 市场整体趋势
- 价格形成机制：
  * 玩家订单与AI订单撮合
  * AI之间订单撮合
  * 做市商AI维持基础流动性

#### 3.3 市场监控
- 异常交易监控：
  * 同IP账户互相交易限制
  * 大额交易分步执行：
    - 单笔＞总股本1%自动拆分
    - 每3分钟执行一次，最多分10次
  * 价格操纵识别：
    - 监控短期内高频小额交易
    - 识别虚假申报行为
- 做空机制优化：
  * 允许做空时间：上市满30天后
  * 单只股票做空上限：流通股本的3%
  * 做空规则：
    - 保证金：20%
    - 平仓线：15%
- 收购公示：
  - 当单日增持＞5%时自动发公告
  - 持股达20%时强制公示资金来源（与公司模块1.3.5收购条件联动）
- 强制平仓条件：
  * 保证金低于维持保证金时
  * 做空持仓时间超过30天
  * 市场剧烈波动时（日内涨幅超过10%）

#### 3.4 数据服务
- 实时行情：
  - 五档盘口（买1-5/卖1-5）
  - 分时图（每分钟一个数据点）
  - K线图（5分钟/1小时/日线）
- 历史数据：
  - 保存完整交易记录
  - 提供CSV格式下载（延迟15分钟）
- 关联指标：
  - 显示公司主要贷款银行信息
  - 质押股票状态可视化（冻结/流通）

### 4. 消息模块
- 市场信息：
  - 实时显示重要事件
  - AI交易者动态
  - 市场趋势分析
- 公司公告：
  - 财务报告
  - 重大事件
  - 股东变动
- 新闻系统：
  - 基于市场数据生成新闻
  - AI行为分析报告
  - 市场趋势预测

## 经济系统
### 1. 通货膨胀控制
- 货币回收：
  * 所有手续费自动销毁
  * 系统维护费：总市值的0.01%

### 2. 市场机制
- AI交易者自动调节：
  * 市场过热时增加卖盘
  * 市场低迷时增加买盘
- 做市商AI：
  * 维持基础流动性
  * 控制价格波动幅度

### 3. 游戏进度
- 成就系统：
  * 资产目标（10亿、100亿等）
  * 收购成就
  * 交易成就
  * 抗跌成就
- 难度设置：
  * 简单：AI更保守，波动更小
  * 普通：标准AI行为
  * 困难：AI更激进，波动更大
