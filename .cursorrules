# 执行命令流程
## 1. 基本流程
1. **查看规则**：
   * 打开.cursorrules文件
   * 阅读项目规范要求
   * 确认操作是否符合规范

2. **查看项目进度**：
   * 检查当前开发阶段
   * 确认下一步任务
   * 了解任务目标和要求

3. **执行开发任务**：
   * 按照规范编写代码
   * 遵循开发计划
   * 完成具体功能实现

4. **记录变更**：
   * 在每次完成功能开发后，立即执行以下步骤：
     1. 打开 .cursorrules 文件
     2. 找到 "## 2. 变更记录" 部分
     3. 在最后一条记录后添加新记录
     4. 按照以下格式添加：
        序号: xxx
        类型: [新增/修改/修复]
        模块: [功能模块名称]
        描述: [具体变更内容]
        状态: [完成/进行中/计划]
     5. 保存文件

## 2. 变更记录
变更记录:
  序号: 001
  类型: 新增
  模块: 基础框架
  描述: 完成网站基础框架搭建，包括用户认证系统、基础页面模板和数据库设计
  状态: 完成

  序号: 002
  类型: 新增
  模块: 公司管理
  描述: 添加创建公司和发行股票功能
  状态: 完成

  序号: 003
  类型: 新增
  模块: 股票交易
  描述: 添加公司详情页面和股票交易功能
  状态: 完成

  序号: 004
  类型: 新增
  模块: 交易大厅
  描述: 添加交易大厅页面，支持股票列表展示、行业筛选和实时数据刷新
  状态: 完成

  序号: 005
  类型: 新增
  模块: 个人资产
  描述: 添加个人资产页面，包括资产概览、持仓列表和交易记录
  状态: 完成

  序号: 006
  类型: 新增
  模块: 行情走势
  描述: 添加股票K线图功能，支持查看历史价格走势和成交量
  状态: 完成

  序号: 007
  类型: 新增
  模块: AI玩家
  描述: 添加AI玩家系统，支持多种交易策略和自动交易功能
  状态: 完成

  序号: 008
  类型: 新增
  模块: 银行系统
  描述: 添加银行系统，支持存款、贷款和利息计算功能
  状态: 完成

  序号: 009
  类型: 新增
  模块: 新闻系统
  描述: 添加新闻系统，支持自动生成新闻、新闻列表、新闻详情和评论功能
  状态: 完成

  序号: 010
  类型: 新增
  模块: 定时任务
  描述: 添加定时任务系统，支持AI交易、新闻生成、利息计算和贷款还款的自动执行
  状态: 完成

  序号: 011
  类型: 修改
  模块: 系统配置
  描述: 添加APScheduler依赖，优化gunicorn配置，确保定时任务在生产环境正常运行
  状态: 完成
  
  序号: 012
  类型: 修复
  模块: 数据模型
  描述: 添加缺失的交易订单和交易记录模型类
  状态: 完成

  序号: 013
  类型: 修复
  模块: 数据模型
  描述: 修复交易订单和交易记录模型字段与数据库不一致的问题
  状态: 完成

  序号: 014
  类型: 修复
  模块: 数据模型
  描述: 修复News和AIStrategy模型字段与数据库不一致的问题，删除未使用的BankTransaction模型
  状态: 完成

  序号: 015
  类型: 修复
  模块: 数据模型
  描述: 修复News对象创建时的语法错误
  状态: 完成
  
  变更记录:
  序号: 016
  类型: 新增
  模块: 数据库
  描述: 添加存款账户和贷款账户表
  状态: 完成

  序号: 018
  类型: 修复
  模块: 系统功能
  描述: 修复定时任务的应用上下文问题，完善公司创建功能的错误处理
  状态: 完成

  序号: 019
  类型: 修复
  模块: 公司管理
  描述: 修复公司创建功能的路由逻辑，完善输入验证
  状态: 完成

  序号: 020
  类型: 修复
  模块: 公司管理
  描述: 修复公司创建时持股记录的company_id为空的问题
  状态: 完成

  序号: 021
  类型: 修复
  模块: 数据库
  描述: 添加缺失的stock_prices表，修复Query.get()的废弃警告
  状态: 完成

  序号: 022
  类型: 修复
  模块: 系统功能
  描述: 修复定时任务的应用上下文问题，调整代码结构，将装饰器定义移到前面
  状态: 完成

  序号: 023
  类型: 修复
  模块: 交易功能
  描述: 完善股票交易功能，添加详细的输入验证和错误提示，修复交易金额计算问题
  状态: 完成

  序号: 024
  类型: 修复
  模块: AI功能
  描述: 修复AI玩家创建功能的语法错误，添加错误处理和日志记录
  状态: 完成

## 3. 环境配置
### 1.1 基本信息
- 项目名称: cs.aiwanba.net
- 项目端口: 5010
- Python版本: 3.11.9
- 域名: localhost

### 1.2 启动配置
- 启动方式: gunicorn -c gunicorn_conf.py app:app
- 项目路径: /www/wwwroot/cs.aiwanba.net
- 当前框架: flask
- 入口文件: /www/wwwroot/cs.aiwanba.net/app.py
- 通讯协议: gunicorn
- 应用名称: app

### 1.3 数据库配置
- 数据库: MySQL 5.7.40
- 数据库名: cs_aiwanba_net
- 用户名: cs_aiwanba_net
- 密码: sQz9HSnF5ZcXj9SX
- 主机: localhost
- 端口: 3306

### 1.4 依赖管理
- 依赖文件: requirements.txt
- 镜像源: https://pypi.tuna.tsinghua.edu.cn/simple
- 安装命令: pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple

### 1.5 Gunicorn配置
配置文件路径: /www/wwwroot/cs.aiwanba.net/gunicorn_conf.py
主要配置:
- workers: 4
- threads: 2
- user: 'www'
- worker_class: 'uvicorn.workers.UvicornWorker'
- bind: '0.0.0.0:5010'
- 日志级别: info

### 1.6 前端技术栈
- 基础框架：
  * HTML5
  * CSS3
  * JavaScript (ES6+)
- UI框架：
  * Bootstrap 5
  * jQuery 3.x
- 图表工具：
  * ECharts (用于股票走势图)
- WebSocket：
  * Socket.IO (用于实时数据更新)

## 4. 项目功能模块
### 2.1 公司模块
- 公司创建与股票发行
  - 创建公司功能
    * 公司基本信息设置（名称、简介、行业类型）
    * 初始资金配置
    * 股权结构设计
  - 设定初始股票发行
    * 发行数量和价格设置
    * IPO流程管理
    * 股票分配机制
  - 公司经营决策系统
    * 分红政策制定
    * 股票回购功能
    * 公司财务报表生成
- 公司收购与合并
  - 收购发起功能
    * 收购价格设定
    * 收购条件制定
    * 股权转让流程
  - 市场影响计算系统
    * 股价影响评估
    * 市场反应模拟
    * 连锁反应计算

### 2.2 交易所模块
- 股票交易系统
  - 实时交易功能
    * 买卖订单管理
    * 价格匹配机制
    * 交易限制控制
  - 价格波动计算
    * 实时价格更新
    * 涨跌幅限制
    * 成交量分析
  - 交易记录管理
    * 历史交易查询
    * 交易数据统计
    * 异常交易监控
- 市场信息展示
  - 实时行情
    * 股票价格走势图
    * 成交量显示
    * 买卖盘口数据
  - 交易数据统计
    * 市场成交总量
    * 个股交易统计
    * 市场趋势分析

### 2.3 银行模块
- 资金管理系统
  - 存款功能
    * 活期存款
    * 定期存款
    * 利息计算器
  - 贷款功能
    * 信用评估
    * 贷款申请流程
    * 还款计划管理
  - 利息计算
    * 复利计算
    * 本息统计
    * 收益预测
- 利率调整系统
  - 市场资金监控
    * 资金流向分析
    * 市场流动性评估
    * 风险预警机制
  - 利率动态调整
    * 基准利率设定
    * 利率浮动范围
    * 调整周期管理

### 2.4 新闻与事件模块
- 新闻生成系统
  - 玩家行为触发
    * 重大交易新闻
    * 公司运营动态
    * 市场异动报道
  - AI行为触发
    * AI交易行为报道
    * 市场趋势分析
    * 预测性新闻
  - 公司公告系统
    * 定期报告发布
    * 重大事项公告
    * 临时公告管理
- 市场影响系统
  - 新闻影响计算
    * 影响力评分
    * 持续时间估算
    * 波及范围预测
  - 市场情绪分析
    * 情绪指数计算
    * 投资者反应预测
    * 市场趋势判断

### 2.5 AI玩家模块
- AI决策系统
  - 行为算法
    * 交易策略生成
    * 风险评估机制
    * 收益目标设定
  - 角色多样化
    * 投资风格定义
    * 决策模式设计
    * 行为模式切换
  - 市场适应性
    * 策略动态调整
    * 市场趋势识别
    * 自我学习优化
- 交互影响系统
  - 与玩家互动
    * 交易对手匹配
    * 策略互补设计
    * 竞争机制实现
  - 市场影响计算
    * 交易量影响
    * 价格影响评估
    * 市场情绪影响

### 2.6 玩家互动模块
- 聊天系统
  - 基础聊天功能
    * 世界频道聊天
    * 私聊功能
    * 表情包支持
  - 交易讨论
    * 股票评论区
    * 市场讨论区
    * 简单回复功能
- 简单组队
  - 基础组队
    * 创建/加入/退出队伍
    * 队伍成员列表
    * 队伍公告
  - 组队收益
    * 队伍总资产显示
    * 成员贡献榜
    * 简单分红功能

### 2.7 分析工具模块
- 数据分析系统
  - 价格走势分析
    * 技术指标计算
    * 趋势线绘制
    * 支撑阻力分析
  - 市场趋势分析
    * 市场情绪指标
    * 成交量分析
    * 板块联动分析
  - 公司财务分析
    * 财务指标计算
    * 对比分析功能
    * 风险评估报告

## 5. 简化开发计划
### 第一步：搭建基础
- 做什么：
  * 建立网站框架
  * 做登录注册功能
  * 设计数据库
- 完成标准：
  * 能注册新用户
  * 能登录账号
  * 能看到主页面

### 第二步：股票交易
- 做什么：
  * 创建公司功能
  * 发行股票功能
  * 买卖股票功能
- 完成标准：
  * 能创建新公司
  * 能发行新股票
  * 能买卖股票

### 第三步：银行系统
- 做什么：
  * 存款功能
  * 贷款功能
  * 利息计算
- 完成标准：
  * 能存取钱
  * 能申请贷款
  * 能看到利息收入

### 第四步：AI玩家
- 做什么：
  * 创建AI玩家
  * 设计AI交易行为
- 完成标准：
  * AI能自动交易
  * AI能影响市场

### 第五步：互动功能
- 做什么：
  * 聊天功能
  * 组队功能
- 完成标准：
  * 能和其他玩家聊天
  * 能组队玩游戏

### 第六步：完善功能
- 做什么：
  * 修复问题
  * 优化体验
  * 测试功能
- 完成标准：
  * 游戏运行流畅
  * 没有明显错误

## 6. 开发注意事项
1. 每完成一步都要测试
2. 发现问题及时修复
3. 保持简单易用
4. 优先做核心功能

## 7. 成功标准
1. 游戏好玩有趣
2. 操作简单方便
3. 运行稳定流畅
4. 新手容易上手

## 8. 项目里程碑
1. 第一阶段完成：基础功能可用
2. 第二阶段完成：交易系统完善
3. 第三阶段完成：AI系统运行
4. 第四阶段完成：功能全部实现
5. 最终阶段完成：系统正式上线


