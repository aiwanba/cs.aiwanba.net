# .cursorrules 文件模板
本文件用于记录项目的规范和配置信息。请根据项目实际情况填写以下内容。

## 重要提示
- 每次文件操作（创建/修改/删除）后必须立即更新本文件，确保记录与代码变更同步
- 每次编写代码必须更新本文件，确保涵盖以下关键内容：
  - **项目背景**：明确项目的目标和范围
    - 目标需包含产品定位和核心功能
    - 范围应界定功能模块和技术边界
  - **编码标准**：定义代码风格、命名规范等
    - 需包含缩进、引号、分号等基础规则
    - 命名规范要区分变量/组件/常量
  - **首选库**：列出项目中使用的库及其版本
    - 格式：`库名称 | 语义化版本 | 主要用途`
    - 版本号必须使用^锁定主版本
  - **文件结构**：描述项目的目录结构和文件组织方式
    - 需说明核心目录作用
    - 重要配置文件的存放位置
  - **性能优化指南**：提供性能优化的建议和最佳实践
    - 包含加载优化、渲染优化等方案
    - 需注明适用场景和实现方式
  - **测试要求**：明确测试的范围、方法和工具
    - 单元测试覆盖率目标值
    - E2E测试的核心流程
  - **文档规范**：规定代码注释、README等的编写标准
    - 公共方法必须使用JSDoc注释
    - 复杂逻辑需添加行内说明
  - **错误处理**：定义错误处理机制和日志记录方式
    - 全局错误拦截方案
    - 日志分级和存储策略
  - **项目下一步**：明确后续计划
    - 区分已实现/未实现功能
    - 计划需包含优先级和预期时间
- 所有文件操作必须记录变更：
  - 创建文件需说明用途
  - 修改文件需描述变更内容
  - 版本变更遵循语义化版本规范
- 文件维护要求：
  - 保持.cursorrules与实际代码完全同步
  - 变更记录需在操作完成后立即更新
  - 代码提交前必须校验.cursorrules更新状态
  - 版本发布时必须校验变更记录完整性

---

## 项目背景
- **项目目标**：  
  构建一个基于 Flask 框架的在线股票交易游戏平台，让玩家通过与 AI 玩家互动，体验真实的股票市场交易过程，学习投资策略和风险管理。

- **项目范围**：  
  1. 核心功能模块：
     - 公司管理系统（创建、股票发行、收购合并）
     - 交易所系统（实时交易、价格走势）
     - 银行系统（存贷款、利率管理）
     - 新闻事件系统（市场动态、公司公告）
     - AI 玩家行为系统
     - 社交互动系统
     - 市场分析工具
     - 成就与排行榜系统

  2. 技术实现范围：
     - Web 服务端开发（Flask框架）
     - 实时数据处理（WebSocket）
     - 数据库交互（MySQL）
     - AI 行为算法实现
     - API 接口服务
     - 前端技术栈：
       - HTML5 + CSS3：基础页面结构和样式
       - Bootstrap 5：响应式布局和基础组件
       - jQuery：DOM操作和AJAX请求
       - Chart.js：股票走势图表展示
     - 实时消息推送
     - 性能优化和安全防护

  3. 用户交互范围：
     - 玩家操作界面
     - 实时市场数据展示
     - 社交互动功能
     - 数据分析工具
     - 排行榜系统

---

## 编码标准
- **代码风格**：  
  - Python 代码遵循 PEP 8 规范
  - 使用 4 空格缩进
  - 文件使用 UTF-8 编码
- **命名规范**：  
  - 变量和函数使用小写字母加下划线
  - 类名使用驼峰命名
  - 常量使用大写字母加下划线

---

## 首选库
| 库名称 | 版本 | 用途 |
|--------|------|------|
| Flask | ^2.0+ | Web 框架 |
| gunicorn | ^20.0+ | WSGI HTTP 服务器 |
| uvicorn | ^0.15+ | ASGI 服务器 |
| MySQL-python | ^5.7.40 | MySQL 数据库驱动 |
| Flask-SQLAlchemy | ^2.5+ | ORM 数据库操作 |
| Flask-SocketIO | ^5.0+ | WebSocket 实时通信 |
| Flask-Login | ^0.6+ | 用户认证管理 |
| Flask-Migrate | ^4.0+ | 数据库迁移工具 |
| Flask-WTF | ^1.1+ | 表单验证和CSRF保护 |
| PyJWT | ^2.0+ | JWT token认证 |
| APScheduler | ^3.10+ | 定时任务（AI行为、利率调整等） |
| python-socketio | ^5.0+ | Socket.IO服务端实现 |
| eventlet | ^0.33+ | Socket.IO异步支持 |
| pandas | ^2.0+ | 数据分析（股票价格计算） |
| Bootstrap | ^5.3+ | 前端UI框架 |
| jQuery | ^3.7+ | 前端交互处理 |
| Chart.js | ^4.0+ | 图表展示 |

---

## 文件结构
| 文件夹/文件 | 文件描述 |
|--------|----------|
| /www/wwwroot/cs.aiwanba.net/ | 项目根目录 |
| ├── app.py | Flask应用入口文件 |
| ├── gunicorn_conf.py | Gunicorn配置文件 |
| ├── requirements.txt | 项目依赖文件 |
| ├── .cursorrules | 项目规范文件 |
| ├── apps/ | 应用代码目录 |
| │   ├── __init__.py | 应用包初始化文件 |
| │   ├── models/ | 数据模型目录 |
| │   │   ├── __init__.py | 模型包初始化文件 |
| │   │   ├── user.py | 用户模型 |
| │   │   ├── company.py | 公司模型 |
| │   │   ├── stock.py | 股票持有记录模型 |
| │   │   ├── transaction.py | 交易记录模型 |
| │   │   ├── bank.py | 银行账户模型 |
| │   │   ├── news.py | 新闻模型 |
| │   │   └── ai.py | AI行为模型 |
| │   ├── services/ | 服务层目录 |
| │   │   ├── __init__.py | 服务包初始化文件 |
| │   │   ├── auth_service.py | 认证服务 |
| │   │   ├── trading_service.py | 交易服务 |
| │   │   ├── company_service.py | 公司管理服务 |
| │   │   ├── bank_service.py | 银行业务服务 |
| │   │   ├── news_service.py | 新闻服务 |
| │   │   ├── ai_service.py | AI交易服务 |
| │   │   └── socket_service.py | WebSocket服务 |
| │   └── api/ | API接口目录 |
| │       ├── __init__.py | API包初始化文件 |
| │       ├── auth.py | 认证API |
| │       ├── trading.py | 交易API |
| │       ├── company.py | 公司管理API |
| │       ├── bank.py | 银行业务API |
| │       ├── news.py | 新闻API |
| │       └── ai.py | AI交易API |
| ├── templates/ | 模板目录 |
| │   ├── index.html | 首页模板 |
| │   ├── company/ | 公司相关模板 |
| │   │   └── create.html | 创建公司页面 |
| │   └── trading/ | 交易相关模板 |
| │       └── trade.html | 交易页面 |
| ├── static/ | 静态文件目录 |
| │   ├── css/ | 样式文件目录 |
| │   ├── js/ | JavaScript文件目录 |
| │   │   └── socket.js | WebSocket客户端处理 |
| │   └── img/ | 图片资源目录 |
| ├── tests/ | 测试目录 |
| │   ├── __init__.py | 测试包初始化文件 |
| │   ├── conftest.py | 测试配置文件 |
| │   ├── test_basic.py | 基本测试用例 |
| │   └── performance_test.py | 性能测试脚本 |
| ├── migrations/ | 数据库迁移目录 |
| │   ├── env.py | 迁移环境配置 |
| │   └── versions/ | 迁移版本目录 |
| │       └── initial_migration.py | 初始数据库迁移文件 |
| └── doc/ | 文档目录 |
|     ├── 生产环境部署配置文档.md | 部署配置说明文档 |
|     └── 部署指南.md | 生产环境部署指南 |
| /www/wwwlogs/python/cs_aiwanba_net/ | 日志目录 |
| ├── gunicorn_access.log | 访问日志文件 |
| └── gunicorn_error.log | 错误日志文件 |

---

## 性能优化指南
- 使用 Gunicorn 多进程部署(4个工作进程)
- 每个进程配置2个线程
- 使用 uvicorn.workers.UvicornWorker 作为工作模式
- 配置合适的日志级别(info)避免性能损耗

---

## 测试要求
- 部署前检查数据库连接是否正常
- 检查端口(5010)是否可用
- 验证日志目录权限

---

## 文档规范
- **代码注释**：  
  - 所有函数必须包含功能说明
  - 复杂逻辑需要详细的行内注释
- **API文档**：  
  - 所有接口需要标注请求方法、参数和返回值
  - 接口文档需要包含示例

---

## 错误处理
- 错误日志路径：/www/wwwlogs/python/cs_aiwanba_net/gunicorn_error.log
- 访问日志路径：/www/wwwlogs/python/cs_aiwanba_net/gunicorn_acess.log
- 日志级别设置为 info
- 使用 Gunicorn 的内置错误处理机制

---

## 部署配置
### 基本信息
- **项目名称**: cs_aiwanba_net
- **项目端口**: 5010
- **Python版本**: 3.11.9
- **域名**: localhost

### 数据库配置
- **数据库**: MySQL 5.7.40
- **数据库名**: cs_aiwanba_net
- **用户名**: cs_aiwanba_net
- **密码**: sQz9HSnF5ZcXj9SX
- **主机**: localhost
- **端口**: 3306

### 启动配置
- **启动命令**: gunicorn -c gunicorn_conf.py app:app
- **项目路径**: /www/wwwroot/cs.aiwanba.net
- **框架**: flask
- **入口文件**: app.py

---

## 文件变更记录
### 创建文件
| 序列号 | 文件名称 | 文件描述 |
|-------|----------|----------|
| 1 | doc/生产环境部署配置文档.md | 生产环境部署配置说明文档 |
| 2 | .cursorrules | 项目规范文件 |
| 3 | requirements.txt | 项目依赖配置文件 |
| 4 | gunicorn_conf.py | Gunicorn服务器配置文件 |
| 5 | app.py | Flask应用入口文件 |
| 6 | templates/index.html | 首页模板文件 |
| 7 | apps/models/user.py | 用户模型 |
| 8 | apps/models/company.py | 公司模型 |
| 9 | apps/models/stock.py | 股票持有记录模型 |
| 10 | apps/models/transaction.py | 交易记录模型 |
| 11 | apps/models/bank.py | 银行账户模型 |
| 12 | apps/models/news.py | 新闻模型 |
| 13 | apps/models/ai.py | AI行为模型 |
| 14 | migrations/env.py | 数据库迁移环境配置 |
| 15 | migrations/versions/initial_migration.py | 初始数据库迁移文件 |
| 16 | apps/services/auth_service.py | 认证服务 |
| 17 | apps/services/trading_service.py | 交易服务 |
| 18 | apps/api/auth.py | 认证API |
| 19 | apps/services/company_service.py | 公司管理服务 |
| 20 | apps/api/company.py | 公司管理API |
| 21 | templates/company/create.html | 创建公司页面 |
| 22 | apps/api/trading.py | 交易API |
| 23 | templates/trading/trade.html | 交易页面 |
| 24 | apps/services/bank_service.py | 银行业务服务 |
| 25 | apps/api/bank.py | 银行业务API |
| 26 | apps/services/news_service.py | 新闻服务 |
| 27 | apps/api/news.py | 新闻API |
| 28 | apps/services/ai_service.py | AI交易服务 |
| 29 | apps/api/ai.py | AI交易API |
| 30 | apps/services/socket_service.py | WebSocket服务 |
| 31 | static/js/socket.js | WebSocket客户端处理 |
| 32 | tests/conftest.py | 测试配置文件 |
| 33 | tests/test_basic.py | 基本测试用例 |
| 34 | tests/performance_test.py | 性能测试脚本 |
| 35 | doc/部署指南.md | 生产环境部署指南 |
| 36 | apps/__init__.py | 应用包初始化文件 |
| 37 | apps/models/__init__.py | 数据模型包初始化文件 |
| 38 | apps/services/__init__.py | 服务层包初始化文件 |
| 39 | apps/api/__init__.py | API接口包初始化文件 |
| 40 | tests/__init__.py | 测试包初始化文件 |

### 修改文件
| 序列号 | 文件名称 | 修改内容 |
|-------|----------|----------|
| 1 | .cursorrules | 初始化项目规范文件 |
| 2 | .cursorrules | 更新文件变更记录 |

### 版本变更
| 版本号 | 变更说明 |
|-------|----------|
| 0.0.1 | 项目初始化：创建项目规范文件和部署文档 |
| 0.0.2 | 创建基础项目框架：添加配置文件和基础模板 |
| 0.0.3 | 添加数据库模型：创建核心数据模型文件 |
| 0.0.4 | 添加业务逻辑：创建服务层和API接口 |
| 0.0.5 | 添加公司管理功能：服务层、API和前端页面 |
| 0.0.6 | 完善交易功能：添加卖出、持仓和历史记录功能 |
| 0.0.7 | 添加银行业务功能：存款、贷款和利息计算 |
| 0.0.8 | 添加新闻系统：新闻生成和市场影响 |
| 0.0.9 | 添加AI交易系统：AI行为决策和自动交易 |
| 0.1.0 | 添加实时数据推送：WebSocket服务和前端更新 |
| 0.1.1 | 添加部署和测试配置：测试脚本和性能测试 |
| 0.1.2 | 添加生产环境部署指南：部署步骤和维护说明 |
| 0.1.3 | 创建项目目录结构和初始化文件 |
| 0.1.4 | 添加数据库迁移文件：初始化数据库结构 |

---

## 项目下一步
### 已实现功能
- 项目规范文件(.cursorrules)创建完成
- 部署配置文档创建完成
- 基础项目框架搭建完成
- 数据库模型设计完成
- 基础业务逻辑实现

### 未实现功能
- 无

### 下一步计划
1. 执行部署
   - 创建目录结构 ✓
   - 初始化包文件 ✓
   - 按部署指南配置环境
   - 初始化数据库 ✓
   - 启动服务
2. 进行测试
   - 运行单元测试
   - 执行性能测试
   - 验证功能完整性
3. 优化系统
   - 分析测试结果
   - 优化性能瓶颈
   - 完善错误处理
