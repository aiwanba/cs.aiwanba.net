{% extends "layouts/module.html" %}

{% block title %}创建公司 - 股票交易游戏{% endblock %}

{% block module_title %}创建新公司{% endblock %}

{% block module_content %}
<div class="company-form-container">
    <form id="createCompanyForm" class="company-form">
        <div class="form-group">
            <label for="name">公司名称</label>
            <input type="text" id="name" name="name" required>
            <small>请输入一个独特的公司名称</small>
        </div>
        
        <div class="form-group">
            <label for="description">公司简介</label>
            <textarea id="description" name="description" rows="4" required></textarea>
            <small>详细描述公司的业务和发展方向</small>
        </div>
        
        <div class="form-group">
            <label for="total_shares">发行股份数量</label>
            <input type="number" id="total_shares" name="total_shares" min="1000" step="1000" required>
            <small>建议发行1000的整数倍股份</small>
        </div>
        
        <div class="form-group">
            <label for="initial_price">初始股价</label>
            <input type="number" id="initial_price" name="initial_price" min="0.01" step="0.01" required>
            <small>设置合理的初始股价，这将影响投资者的购买意愿</small>
        </div>
        
        <div class="form-summary">
            <h3>发行概要</h3>
            <p>总市值：<span id="totalValue">¥0.00</span></p>
            <p>创建成本：<span id="createCost">¥0.00</span></p>
            <p class="note">注：创建公司需要支付总市值1%的费用</p>
        </div>
        
        <button type="submit" class="btn">创建公司</button>
    </form>
</div>
{% endblock %}

{% block scripts %}
<script>
// 计算总市值和创建成本
function updateSummary() {
    const shares = parseFloat(document.getElementById('total_shares').value) || 0;
    const price = parseFloat(document.getElementById('initial_price').value) || 0;
    const totalValue = shares * price;
    const createCost = totalValue * 0.01;
    
    document.getElementById('totalValue').textContent = formatMoney(totalValue);
    document.getElementById('createCost').textContent = formatMoney(createCost);
}

// 监听输入变化
document.getElementById('total_shares').addEventListener('input', updateSummary);
document.getElementById('initial_price').addEventListener('input', updateSummary);

// 处理表单提交
document.getElementById('createCompanyForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const formData = {
        name: document.getElementById('name').value,
        description: document.getElementById('description').value,
        total_shares: parseInt(document.getElementById('total_shares').value),
        initial_price: parseFloat(document.getElementById('initial_price').value)
    };
    
    try {
        const response = await fetch('/company/create', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(formData)
        });
        const result = await response.json();
        if (result.success) {
            alert('公司创建成功！');
            window.location.href = `/company/info/${result.data.id}`;
        } else {
            alert(result.message);
        }
    } catch (error) {
        alert('创建失败，请重试');
    }
});
</script>
{% endblock %} 