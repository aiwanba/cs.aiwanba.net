{% extends "base.html" %}

{% block content %}
<h1>交易所</h1>

<section class="market-overview">
    <h2>市场概况</h2>
    <div class="stats">
        <div class="stat-item">
            <span class="label">总市值:</span>
            <span class="value">{{ "%.2f"|format(market_cap) }}</span>
        </div>
        <div class="stat-item">
            <span class="label">市场指数:</span>
            <span class="value">{{ "%.2f"|format(market_index) }}</span>
        </div>
    </div>
</section>

<section class="top-companies">
    <h2>市值排名前5的公司</h2>
    <table>
        <thead>
            <tr>
                <th>排名</th>
                <th>公司名称</th>
                <th>市值</th>
                <th>行业</th>
            </tr>
        </thead>
        <tbody>
            {% for company in top_companies %}
            <tr>
                <td>{{ loop.index }}</td>
                <td><a href="{{ url_for('company_detail', company_id=company.id) }}">{{ company.name }}</a></td>
                <td>{{ "%.2f"|format(company.capital) }}</td>
                <td>{{ company.industry }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</section>

<section class="listed-companies">
    <h2>上市公司列表</h2>
    <table>
        <thead>
            <tr>
                <th>公司名称</th>
                <th>市值</th>
                <th>股票数量</th>
                <th>行业</th>
            </tr>
        </thead>
        <tbody>
            {% for company in listed_companies %}
            <tr>
                <td><a href="{{ url_for('company_detail', company_id=company.id) }}">{{ company.name }}</a></td>
                <td>{{ "%.2f"|format(company.capital) }}</td>
                <td>{{ company.stock_count }}</td>
                <td>{{ company.industry }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</section>

<section class="listing">
    <h2>上市/退市</h2>
    <form method="POST" action="{{ url_for('list_company') }}">
        <label for="company_id">公司ID:</label>
        <input type="number" id="company_id" name="company_id" required>
        <button type="submit">上市</button>
    </form>
    <form method="POST" action="{{ url_for('delist_company') }}">
        <label for="company_id">公司ID:</label>
        <input type="number" id="company_id" name="company_id" required>
        <button type="submit">退市</button>
    </form>
</section>

<section class="margin-trading">
    <h2>融资融券</h2>
    <form method="POST" action="{{ url_for('margin_trading') }}">
        <label for="company_id">公司ID:</label>
        <input type="number" id="company_id" name="company_id" required>
        <label for="amount">金额:</label>
        <input type="number" id="amount" name="amount" required>
        <button type="submit">申请</button>
    </form>
</section>

<section class="industry-analysis">
    <h2>行业分析</h2>
    <canvas id="industryChart"></canvas>
</section>
{% endblock %}