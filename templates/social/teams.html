{% extends "base.html" %}

{% block title %}投资团队 - 股票交易游戏{% endblock %}

{% block content %}
<div class="teams-container">
    <div class="teams-header">
        <h2>投资团队</h2>
        <a href="{{ url_for('social.create_team') }}" class="btn">创建团队</a>
    </div>

    <div class="teams-filters">
        <input type="text" id="searchTeam" placeholder="搜索团队..." class="search-input">
        <select id="sortTeams" class="sort-select">
            <option value="newest">最新创建</option>
            <option value="members">成员最多</option>
            <option value="active">最活跃</option>
        </select>
    </div>

    <div class="teams-grid">
        {% for team in teams %}
        <div class="team-card">
            <div class="team-header">
                <h3>{{ team.name }}</h3>
                <span class="member-count">{{ team.members|length }}名成员</span>
            </div>
            <p class="team-desc">{{ team.description }}</p>
            <div class="team-stats">
                <div class="stat-item">
                    <label>讨论</label>
                    <span>{{ team.discussions|length }}</span>
                </div>
                <div class="stat-item">
                    <label>创建时间</label>
                    <span>{{ team.created_at.strftime('%Y-%m-%d') }}</span>
                </div>
            </div>
            <div class="team-actions">
                <a href="{{ url_for('social.team_page', team_id=team.id) }}" class="btn">查看详情</a>
                {% if not team.is_member %}
                <button class="btn join-btn" data-team-id="{{ team.id }}">加入团队</button>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// 处理加入团队
document.querySelectorAll('.join-btn').forEach(btn => {
    btn.addEventListener('click', async () => {
        const teamId = btn.dataset.teamId;
        try {
            const response = await fetch('/social/team/join', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    team_id: teamId
                })
            });
            const result = await response.json();
            alert(result.message);
            if (result.success) {
                location.reload();
            }
        } catch (error) {
            alert('加入失败，请重试');
        }
    });
});

// 处理团队搜索
const searchInput = document.getElementById('searchTeam');
searchInput.addEventListener('input', (e) => {
    const searchText = e.target.value.toLowerCase();
    document.querySelectorAll('.team-card').forEach(card => {
        const teamName = card.querySelector('h3').textContent.toLowerCase();
        const teamDesc = card.querySelector('.team-desc').textContent.toLowerCase();
        if (teamName.includes(searchText) || teamDesc.includes(searchText)) {
            card.style.display = 'block';
        } else {
            card.style.display = 'none';
        }
    });
});

// 处理团队排序
const sortSelect = document.getElementById('sortTeams');
sortSelect.addEventListener('change', async () => {
    const sortBy = sortSelect.value;
    try {
        const response = await fetch(`/social/teams?sort=${sortBy}`);
        const result = await response.json();
        if (result.success) {
            location.reload();
        }
    } catch (error) {
        console.error('排序失败:', error);
    }
});
</script>
{% endblock %} 