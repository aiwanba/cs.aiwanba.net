{% extends "base.html" %}

{% block title %}我的资产 - 股票交易游戏{% endblock %}

{% block content %}
<div class="row">
    <!-- 资产概览 -->
    <div class="col-md-12 mb-4">
        <div class="card">
            <div class="card-header">
                <h4 class="mb-0">资产概览</h4>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3">
                        <div class="border rounded p-3 text-center">
                            <h6 class="text-muted">总资产</h6>
                            <h4 class="mb-0">¥{{ "{:,.2f}".format(total_assets) }}</h4>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="border rounded p-3 text-center">
                            <h6 class="text-muted">可用资金</h6>
                            <h4 class="mb-0">¥{{ "{:,.2f}".format(current_user.balance) }}</h4>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="border rounded p-3 text-center">
                            <h6 class="text-muted">持仓市值</h6>
                            <h4 class="mb-0">¥{{ "{:,.2f}".format(stock_value) }}</h4>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="border rounded p-3 text-center">
                            <h6 class="text-muted">持仓收益</h6>
                            <h4 class="mb-0 {{ 'text-danger' if total_profit > 0 else 'text-success' if total_profit < 0 else '' }}">
                                ¥{{ "{:,.2f}".format(total_profit) }}
                            </h4>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 持仓列表 -->
    <div class="col-md-12 mb-4">
        <div class="card">
            <div class="card-header">
                <h4 class="mb-0">持仓列表</h4>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead>
                            <tr>
                                <th>股票代码</th>
                                <th>公司名称</th>
                                <th>持仓数量</th>
                                <th>成本价</th>
                                <th>现价</th>
                                <th>市值</th>
                                <th>盈亏</th>
                                <th>盈亏比例</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for holding in holdings %}
                            {% if holding.shares > 0 %}
                            <tr>
                                <td>{{ holding.company.code }}</td>
                                <td>{{ holding.company.name }}</td>
                                <td>{{ "{:,}".format(holding.shares) }}</td>
                                <td>¥{{ "%.2f"|format(holding.average_cost) }}</td>
                                <td>¥{{ "%.2f"|format(holding.company.current_price) }}</td>
                                <td>¥{{ "{:,.2f}".format(holding.market_value) }}</td>
                                <td class="{{ 'text-danger' if holding.profit > 0 else 'text-success' if holding.profit < 0 else '' }}">
                                    ¥{{ "{:,.2f}".format(holding.profit) }}
                                </td>
                                <td class="{{ 'text-danger' if holding.profit_percent > 0 else 'text-success' if holding.profit_percent < 0 else '' }}">
                                    {{ "%.2f"|format(holding.profit_percent) }}%
                                </td>
                                <td>
                                    <a href="{{ url_for('company_detail', code=holding.company.code) }}" 
                                       class="btn btn-sm btn-primary">交易</a>
                                </td>
                            </tr>
                            {% endif %}
                            {% endfor %}
                            {% if not holdings %}
                            <tr>
                                <td colspan="9" class="text-center">暂无持仓</td>
                            </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- 交易记录 -->
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <h4 class="mb-0">最近交易</h4>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead>
                            <tr>
                                <th>时间</th>
                                <th>股票</th>
                                <th>类型</th>
                                <th>价格</th>
                                <th>数量</th>
                                <th>金额</th>
                                <th>状态</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for order in orders %}
                            <tr>
                                <td>{{ order.created_at.strftime('%Y-%m-%d %H:%M:%S') }}</td>
                                <td>{{ order.company.name }} ({{ order.company.code }})</td>
                                <td>
                                    <span class="badge {{ 'bg-success' if order.type == 1 else 'bg-danger' }}">
                                        {{ '买入' if order.type == 1 else '卖出' }}
                                    </span>
                                </td>
                                <td>¥{{ "%.2f"|format(order.price) }}</td>
                                <td>{{ "{:,}".format(order.shares) }}</td>
                                <td>¥{{ "{:,.2f}".format(order.price * order.shares) }}</td>
                                <td>
                                    {% if order.status == 0 %}
                                    <span class="badge bg-warning">待成交</span>
                                    {% elif order.status == 1 %}
                                    <span class="badge bg-info">部分成交</span>
                                    {% elif order.status == 2 %}
                                    <span class="badge bg-success">已成交</span>
                                    {% else %}
                                    <span class="badge bg-danger">已取消</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %} 